name: ğŸ“¬ Telegram notifications (FULL)

on:
  push:
    branches: ["**"]

  pull_request:
    types:
      - opened
      - reopened
      - synchronize
      - edited
      - closed
      - ready_for_review

  pull_request_review:
    types: [submitted, edited, dismissed]

  issues:
    types: [opened, edited, closed, reopened, labeled, unlabeled]

  issue_comment:
    types: [created, edited, deleted]

  release:
    types: [published, prereleased, created, edited]

  workflow_run:
    types: [completed]

  deployment:
  deployment_status:

  discussion:
    types: [created, edited, answered, unanswered]

  discussion_comment:
    types: [created, edited, deleted]

  create:

  fork:

  # Stars (GitHub does NOT have `star` trigger)
  watch:
    types: [started]

  delete:

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ•’ Format time (MSK)
        id: time
        shell: bash
        run: |
          echo "TIME=$(TZ=Europe/Moscow date '+%d.%m.%Y %H:%M (MSK)')" >> "$GITHUB_OUTPUT"

      - name: ğŸ§  Build message
        id: msg
        shell: bash
        run: |
          TITLE="â€”"
          URL="https://github.com/${{ github.repository }}"

          if [ "${{ github.event_name }}" = "push" ]; then
            TITLE="${{ github.event.head_commit.message }}"
            URL="https://github.com/${{ github.repository }}/commit/${{ github.sha }}"
          elif [ "${{ github.event_name }}" = "pull_request" ]; then
            TITLE="${{ github.event.pull_request.title }}"
            URL="${{ github.event.pull_request.html_url }}"
          elif [ "${{ github.event_name }}" = "issues" ]; then
            TITLE="${{ github.event.issue.title }}"
            URL="${{ github.event.issue.html_url }}"
          elif [ "${{ github.event_name }}" = "release" ]; then
            TITLE="${{ github.event.release.name }}"
            URL="${{ github.event.release.html_url }}"
          fi

          echo "TITLE=$TITLE" >> "$GITHUB_OUTPUT"
          echo "URL=$URL" >> "$GITHUB_OUTPUT"

      - name: ğŸ“¤ Send Telegram notification
        uses: appleboy/telegram-action@v0.1.1
        with:
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          format: markdown
          message: |
            *ğŸš¨ GitHub Event Notification*

            *ğŸ“¦ Ğ ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¹:*
            `${{ github.repository }}`

            *ğŸ§© Ğ¢Ğ¸Ğ¿ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ:*
            `${{ github.event_name }}`

            *âš™ï¸ Action:*
            `${{ github.event.action }}`

            *ğŸ‘¤ Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ñ‚Ğ¾Ñ€:*
            `${{ github.actor }}`

            *ğŸŒ¿ Ref:*
            `${{ github.ref_name }}`

            *ğŸ’¬ Ğ—Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº:*
            `${{ steps.msg.outputs.TITLE }}`

            *ğŸ”— URL:*
            ${{ steps.msg.outputs.URL }}

            *â° Ğ’Ñ€ĞµĞ¼Ñ:*
            `${{ steps.time.outputs.TIME }}`