name: ğŸ“¬ Telegram notifications (FULL)

on:
  push:
    branches: ["**"]

  pull_request:
    types:
      - opened
      - reopened
      - synchronize
      - edited
      - closed
      - ready_for_review

  pull_request_review:
    types: [submitted, edited, dismissed]

  issues:
    types: [opened, edited, closed, reopened, labeled, unlabeled]

  issue_comment:
    types: [created, edited, deleted]

  release:
    types: [published, prereleased, created, edited]

  workflow_run:
    types: [completed]

  deployment:
  deployment_status:

  discussion:
    types: [created, edited, answered, unanswered]

  discussion_comment:
    types: [created, edited, deleted]

  create:

  fork:

  # Stars (GitHub does NOT have `star` trigger)
  watch:
    types: [started]

  delete:

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ•’ Format time (MSK)
        id: time
        run: |
          echo "TIME=$(TZ=Europe/Moscow date '+%d.%m.%Y %H:%M (MSK)')" >> $GITHUB_OUTPUT

      - name: ğŸ“‚ Collect changed files
        id: files
        run: |
          git init
          git remote add origin https://github.com/${{ github.repository }}.git
          git fetch --depth=2 origin

          if [ "${{ github.event_name }}" = "push" ]; then
            FILES=$(git diff --name-status HEAD~1 HEAD | sed 's/^/â€¢ /')
          elif [ "${{ github.event_name }}" = "pull_request" ]; then
            git fetch origin ${{ github.event.pull_request.base.ref }}
            FILES=$(git diff --name-status origin/${{ github.event.pull_request.base.ref }}...HEAD | sed 's/^/â€¢ /')
          else
            FILES="â€”"
          fi

          echo "FILES<<EOF" >> $GITHUB_OUTPUT
          echo "$FILES" >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT

      - name: ğŸ“¤ Send Telegram notification
        uses: appleboy/telegram-action@v0.1.1
        with:
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          format: markdown
          message: |
            *ğŸš¨ GitHub Event Notification*

            *ğŸ“¦ Ğ ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¹:*  
            `${{ github.repository }}`

            *ğŸ§© Ğ¢Ğ¸Ğ¿ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ:*  
            `${{ github.event_name }}`

            *âš™ï¸ Action:*  
            `${{ github.event.action || 'â€”' }}`

            *ğŸ‘¤ Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ñ‚Ğ¾Ñ€:*  
            `${{ github.actor }}`

            *ğŸŒ¿ Ref:*  
            `${{ github.ref_name || 'â€”' }}`

            *ğŸ’¬ Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ / Ğ—Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº:*  
            `${{ github.event.head_commit.message
              || github.event.pull_request.title
              || github.event.issue.title
              || github.event.release.name
              || 'â€”' }}`

            *ğŸ“‚ Ğ˜Ğ·Ğ¼ĞµĞ½Ñ‘Ğ½Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹:*  
            ```
            ${{ steps.files.outputs.FILES }}
            ```

            *ğŸ”— URL:*  
            ${{ github.event.pull_request.html_url
              || github.event.issue.html_url
              || github.event.release.html_url
              || github.event.repository.html_url }}

            *â° Ğ’Ñ€ĞµĞ¼Ñ:*  
            `${{ steps.time.outputs.TIME }}`